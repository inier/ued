/*
 * Created with Sublime Text 2.
 * license: http://www.lovewebgames.com/jsmodule/index.html
 * User: 田想兵
 * Date: 2015-03-16
 * Time: 20:27:54
 * Contact: 55342775@qq.com
 */

/*
 * Created with Sublime Text 2.
 * license: http://www.lovewebgames.com/jsmodule/index.html
 * User: 田想兵
 * Date: 2015-04-29
 * Time: 11:06:03
 * Contact: 55342775@qq.com
 */

(function(e,t){typeof define=="function"&&define.amd?define("dialog",["$"],t):typeof exports=="object"?module.exports=t():e.Dialog=t(window.Zepto||window.jQuery||$)})(this,function(e){e.fn.Dialog=function(n){var r=[];return e(this).each(function(){var i=new t,s=e.extend({trigger:e(this)},n);i.init(s),r.push(i)}),r},e.Dialog=function(n){if(n.type==="alert"){var r=new t,i='<div class="ui-alert-title">'+n.content+"</div>",s="";n.button?(typeof n.button=="boolean"&&(n.button="确定"),s='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+n.button+"</button></p>"):n.timer||(n.timer=3e3),i+=s;var o=e.extend({target:i,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(e){this.dispose(),n.callback&&n.callback()}},n);r.init(o),n.timer&&setTimeout(function(){r.dispose(),n.callback&&n.callback()},n.timer),r.touch(r.mask,function(){r.dispose(),n.callback&&n.callback()})}if(n.type==="confirm"){var u=new t,i='<div class="ui-confirm-title">'+n.content+"</div>",s="";n.buttons||(n.buttons=[{yes:"确定"},{no:"取消"}]);var a="";for(var f=0,l=n.buttons.length;f<l;f++){var c=n.buttons[f];c.yes&&(a+='<td><button class="ui-confirm-submit " data-type="yes">'+c.yes+"</button></td>"),c.no&&(a+='<td><button class="ui-confirm-no" data-type="no">'+c.no+"</button></td>"),c.close&&(a+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+c.close+"</button></td>")}s='<table class="ui-dialog-action"><tr>'+a+"</tr></table>",i+=s;var h=e.extend({target:i,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(e){this.dispose()},beforeShow:function(t){u.touch(e(".ui-confirm-submit",t),function(){n.callback&&n.callback.call(u,"yes",t)}),u.touch(e(".ui-confirm-no",t),function(){n.callback&&n.callback.call(u,"no",t)}),u.touch(e(".ui-confirm-close",t),function(){n.callback&&n.callback.call(u,"close",t)})}},n);u.init(h)}},e.alert=function(t,n,r,i,s){var o={},u={zIndex:100,type:"alert"};typeof t=="object"?o=e.extend(u,t):o=e.extend(u,{content:t,button:n,timer:i,callback:r}),e.Dialog(e.extend(o,s))},e.confirm=function(t,n,r,i){var s={},o={zIndex:100,type:"confirm"};typeof t=="object"?s=e.extend(o,t):s=e.extend(o,{content:t,buttons:n,callback:r}),e.Dialog(e.extend(s,i))};var t=function(){var t=Math.random().toString().replace(".","");this.id="dialog_"+t,this.settings={},this.settings.closeTpl=e('<span class="ui-dialog-close js-dialog-close">x</span>'),this.settings.titleTpl=e('<div class="ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=e()};return t.prototype={init:function(t){var n=this;this.settings=e.extend({},this.settings,t),this.settings.mask&&(this.mask=e('<div class="ui-dialog-mask"/>'),e("body").append(this.mask)),e("body").append('<div class="ui-dialog" id="'+this.id+'"></div>'),this.dialogContainer=e("#"+this.id);var r=this.settings.zIndex||10;this.dialogContainer.css({zIndex:r}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:r-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},touch:function(t,n){function i(e){return n.call(this,e)}var r;e(t).on("click",i),e(t).on("touchmove",function(e){r=!0}).on("touchend",function(e){e.preventDefault();if(!r){var t=n.call(this,e,"touch");t||(e.preventDefault(),e.stopPropagation())}r=!1})},bindEvent:function(){var t=this;this.settings.trigger&&(e(this.settings.trigger).click(function(){t.show()}),t.touch(e(this.settings.trigger),function(){t.show()})),e(this.dialogContainer).delegate(".js-dialog-close","click",function(){return t.hide(),!1}),e(window).keydown(function(e){e.keyCode===27&&t.showed&&t.hide()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var t=this;t.settings.beforeHide&&t.settings.beforeHide.call(t,t.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){t.dialogContainer.hide(),typeof t.settings.target=="object"&&e("body").append(t.dialogContainer.hide()),t.settings.afterHide&&t.settings.afterHide.call(t,t.dialogContainer)},500)):(this.dialogContainer.hide(),typeof this.settings.target=="object"&&e("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer))},show:function(){typeof this.settings.target=="string"?/^(\.|\#\w+)/gi.test(this.settings.target)?this.dailogContent=e(this.settings.target):this.dailogContent=e("<div>"+this.settings.target+"</div>"):this.dailogContent=this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,e(this.settings.trigger).blur(),this.setPosition();var t=this;this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){t.setPosition()},1e3),this.settings.animate&&this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")},setPosition:function(){if(this.showed){var e=this;this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var t=this.settings.clientHeight||document.documentElement.clientHeight||document.body.clientHeight,n=this.settings.clientWidth||document.documentElement.clientWidth||document.body.clientWidth,r=this.width/2,i=this.height/2,s=n/2-r,o=t/2-i;s=Math.max(0,s),o=Math.max(0,o),e.dialogContainer.css({position:"fixed",top:o,left:s})}}},t}),function(e,t){typeof define=="function"&&define.amd?define("area",["$"],t):typeof exports=="object"?module.exports=t():e.Area=t(window.Zepto||window.jQuery||$)}(this,function(e){return{init:function(t){e.get(t,function(t){e(".area-input").each(function(){var n=e(".province .area-content",this),r=e(".city .area-content ul",this),i=e(".downtown .area-content ul",this),s=[t.data],o=e("<div/>");for(var u=0,a=s.length;u<a;u++){var f=e("<ul/>"),l=s[u];for(var c=0,h=l.length;c<h;c++){var p=e('<li data-value="'+s[u][c].id+'">'+s[u][c].name+"</li>");f.append(p);var d=s[u][c].child||[];p.click(function(t,n){r.children().hide();var s=r.closest(".area");e(s.children("input")).val(""),e(s.children("span")).html("-- 城市 --"),i.children().hide();var o=i.closest(".area");return e(o.children("input")).val(""),e(o.children("span")).html("-- 市区 --"),(e(this).data("child")||e([])).each(function(){e(this).show()}),n});var v=e("#hd_province");v.val()==s[u][c].id&&(v.next().html(s[u][c].name),function(e){setTimeout(function(){e.trigger("click",!1)})}(p));for(var m=0,g=d.length;m<g;m++){if(!d[m])continue;var y=e('<li data-value="'+d[m].id+'" >'+d[m].name+"</li>"),b=p.data("child",p.data("child")||[]);b.push(y),p.data("child",b),p.data("child"),y.hide(),r.append(y),y.click(function(t,n){return i.children().hide(),(e(this).data("child")||e([])).each(function(){e(this).show()}),n});var v=e("#hd_city");if(v.val()==d[m].id){var w=d[m].name;(function(e,t){setTimeout(function(){e.next().html(w),t.trigger("click",!1)},20)})(v,y)}var E=d[m].child||[];for(var S=0,x=E.length;S<x;S++){if(!E[S])continue;var T=e('<li data-value="'+E[S].id+'">'+E[S].name+"</li>"),b=y.data("child",y.data("child")||[]);b.push(T),y.data("child",b),y.data("child"),T.hide(),i.append(T);var N=e("#hd_downtown");if(N.val()==E[S].id){var C=E[S].name;(function(e){setTimeout(function(){e.next().html(C)},40)})(N)}}}}o.append(f)}n.html(o)})},"json").fail(function(){e.alert("加载地区信息出错，请稍后重试！")}),e(".area-input .area").click(function(){e(".area-input .area").removeClass("active"),e(".area-content").not(e(this).find(".area-content")).hide(),e(this).find(".area-content").toggle();var t=e(this).closest(".area-row");return e(this).find(".area-content:visible").size()?(e(this).addClass("active"),t.css("zIndex",44)):(e(this).removeClass("active"),t.css("zIndex",22)),!1}),e(".area-input .area-content").on("click","ul",function(){return!1}),e(".area-input .area-content").on("click","li",function(){var t=e(this).closest(".area");return t.find("input").val(e(this).data("value")),t.children("span").html(e(this).html()),t.trigger("click"),!1}),e("body").click(function(){e(".area-content").hide(),e(".area-input .area").removeClass("active"),e(".area-row").css("zIndex",22)})}}}),function(e,t){typeof define=="function"&&define.amd?define("upload",["$"],t):typeof exports=="object"?module.exports=t():e.Upload=t(window.Zepto||window.jQuery||$)}(this,function(e){function t(){}return e.extend(t.prototype,{init:function(e){window.uploadCount=window.uploadCount||0,window.uploadCount++;var t=Math.random().toString().replace(".","");this.id="upload_"+t+window.uploadCount.toString(),this.settings=e,this.settings.iframe=!0,this.url=this.settings.url,this.name=this.settings.name||"files",this.target=this.settings.target,this.postTarget=this.settings.postTarget,typeof this.settings.autoPost=="undefined"?this.autoPost=!0:this.autoPost=this.settings.autoPost,this.createIframe(),this.createFile(),this.bindEvent(),this.bindFileChange()},createIframe:function(){this.frameId="iframe_upload";if(e("#"+this.frameId).length==0){var t='<iframe src="about:blank" id="'+this.frameId+'" name="'+this.frameId+'" width="0" height="0" frameborder="0"></iframe>';e("body").append(t)}this.frame=e("#"+this.frameId)},createFile:function(){var t=this;t.form&&t.form.remove(),t.form=e('<form method="post" ENCTYPE="multipart/form-data"><input type="file" style="position:absolute;top:0;left:0;width:1px;height:1px;opacity:0;" id="'+t.id+'" name="'+t.name+'"/></form>'),t.form.attr("target",t.frameId),t.form.css({height:0,widht:0,padding:0}),t.form.attr("action",t.url),e("body").append(t.form),t.fileInput=e("#"+t.id),this.bindFileChange()},postFrame:function(t,n,r){var i=t.value.split("."),s=i[i.length-1],o=this,u=this.settings.accept&&this.settings.accept.split(",")||[],a=!1;for(var f=u.length-1;f>=0;f--){var l=new RegExp(u[f],"i");l.exec(s)&&(a=!0)}if(!a&&u.length){var c="文件格式错误,支持格式："+this.settings.accept;return e.alert?e.alert(c):alert(c),!1}return this.form.submit(),this.frame.off("load"),this.frame.on("load",function(){var t=e(e(this.contentWindow.document).find("body")),n=t.children()[0],i=t.html();n&&n.nodeType==1&&(i=n.innerHTML),typeof i=="string"&&o.settings.type==="json"&&(i=(new Function("return "+i))()),o.settings.callback&&o.settings.callback.call(o,i,o.fileInput,o.name,o.target,r)}),o.createFile(),!0},touch:function(t,n){function i(e){return n.call(this,e)}var r;e(t).on("click",i),e(t).on("touchmove",function(e){r=!0}).on("touchend",function(e){e.preventDefault();if(!r){var t=n.call(this,e,"touch");t||(e.preventDefault(),e.stopPropagation())}r=!1})},bindEvent:function(t){var n=this;this.touch(e(this.target),function(t,r){return e(this).parent().siblings().size()>=n.settings.max?n.settings.maxCallback&&n.settings.maxCallback(this):e(n.fileInput).trigger("click"),!1}),n.bindFileEvent(),this.postTarget&&this.touch(e(this.postTarget),function(e,t){n.args.length&&n.postFrame.apply(n,n.args)&&n.settings.startUpload&&n.settings.startUpload.apply(n,n.args)})},bindFileEvent:function(){var t=this;e(this.fileInput).click(function(e){e.stopPropagation()})},bindFileChange:function(){var t=this;e(t.fileInput).off("change"),e(t.fileInput).on("change",function(e){var n=/^image\//i,r=e.target.files,i="up_"+Math.random().toString().replace(".","");t.args=[this,e,i],t.settings.selected&&t.settings.selected.call(this,this,e,i),t.settings.iframe&&t.autoPost&&t.postFrame(this,e,i)&&t.settings.startUpload&&t.settings.startUpload(t.fileInput,t.target,i)})}}),t}),function(e,t){typeof define=="function"&&define.amd?define("calendar",["$"],t):typeof exports=="object"?module.exports=t():e.Calendar=t(window.Zepto||window.jQuery||$)}(this,function(e){e.fn.Calendar=function(n){var r=[];return e(this).each(function(){var i=new t,s=e.extend({target:e(this)},n);i.init(s),r.push(i)}),r};var t=function(){this.monthArr=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],this.dayArr=["日","一","二","三","四","五","六"];var e=Math.random().toString().replace(".","");this.id="calendar_"+e,this.calendarContainer,this.settings={},this.isShow=!1,this.autohide=!0,this.toolbarTpl='<div class="ui-calendar-toolbar clearfix"><a class="js-calendar-submit">确定</a><a class="js-clear">清空</a><a class="ui-calendar-today">现在</a><a class="ui-calendar-close">关闭</a></div>',this.timeTpl='<div class="ui-calendar-time clearfix"><select class="js-calendar-hours">时</select>:<select class="js-calendar-minutes">分</select>:<select class="js-calendar-second">秒</select></div>',this.dateArr=[],this.maxDays=9999};return t.prototype={separator:"-",defaultDate:new Date,setRange:function(t){this.range=e.extend([null,null],t)},init:function(t){e("body").append('<div class="ui-calendar clearfix" id="'+this.id+'"><div class="ui-calendar-pannel clearfix" data-role="pannel"><span class="ui-calendar-control" data-role="prev-year">&lt;&lt;</span><span class="ui-calendar-control" data-role="prev-month">&lt;</span><span class="ui-calendar-control month" data-role="current-month"></span><span class="ui-calendar-control year" data-role="current-year"></span><span class="ui-calendar-control" data-role="next-month">&gt;</span><span class="ui-calendar-control" data-role="next-year">&gt;&gt;</span></div><div class="calendar-header clearfix"></div><div class="c_days clearfix"></div></div>'),this.calendarContainer=e("#"+this.id);var n=this;this.settings=e.extend({},this.settings,t),this.maxDays=this.settings.maxdays||this.maxDays,this.mutilSeparator=this.settings.mutilSeparator||",",this.settings.target&&e(this.settings.target).size()&&(e(this.settings.target)[0].nodeType===1?this.settings.focusDate=this.settings.focusDate||e(this.settings.target).val():this.settings.focusDate=this.settings.focusDate||e(this.settings.target).prev().val()||"");if(this.settings.focusDate&&!this.settings.multiple){var r=this.settings.focusDate.split(" ")[0].split(this.separator),i=this.settings.focusDate.split(" ")[1]||"00:00:00";this.defaultDate=new Date(r[0],parseInt(r[1])-1,r[2],i.split(":")[0],i.split(":")[1],i.split(":")[2])}if(this.settings.focusDate&&this.settings.multiple){var s=this.settings.focusDate.split(",");for(var o=s.length-1;o>=0;o--){var u=s[o],r=u.split(this.separator);this.dateArr.push(new Date(r[0],parseInt(r[1])-1,r[2]))}this.defaultDate=this.dateArr[0],n._dateInArr(n.defaultDate,n.dateArr)||n.dateArr.push(n.date)}this.settings.multiple&&(this.settings.toolbar=!0),this.settings.toolbar&&(this.autohide=!1);var a=this.settings.zIndex||1;this.calendarContainer.css("zIndex",a),this.date=this.defaultDate,this.setRange(this.settings.range),this.settings.time&&(this.settings.toolbar=!0,this.autohide=!1,this.showTime()),this.showToolbar(),this.bindEvent(),this.settings.target?this.hide():(this.autohide=!1,this.show())},showToolbar:function(){this.settings.toolbar&&this.calendarContainer.append(this.toolbarTpl)},showTime:function(){this.calendarContainer.append(this.timeTpl);var t=this;for(var n=0,r=60;n<r;n++)n<24&&e(".js-calendar-hours",this.calendarContainer).append("<option>"+t._getTowNum(n)+"</option>"),e(".js-calendar-minutes",this.calendarContainer).append("<option>"+t._getTowNum(n)+"</option>"),e(".js-calendar-second",this.calendarContainer).append("<option>"+t._getTowNum(n)+"</option>");var i=this.date,s=t._getTowNum(i.getHours())+":"+t._getTowNum(i.getMinutes())+":"+t._getTowNum(i.getSeconds());e(".js-calendar-hours",this.calendarContainer).val(t._getTowNum(i.getHours())),e(".js-calendar-minutes",this.calendarContainer).val(t._getTowNum(i.getMinutes())),e(".js-calendar-second",this.calendarContainer).val(t._getTowNum(i.getSeconds()))},show:function(){this.calendarContainer.show(),this.date=this.defaultDate,this.formatDate(),this.renderHeader(),this.isShow=!0,this.setPosition(),this.settings.show&&this.settings.show(this.calendarContainer);var e=this;this.timer=setInterval(function(){e.setPosition.call(e)},1e3)},hide:function(){this.calendarContainer.hide(),this.isShow=!1,this.settings.hide&&this.settings.hide(this.calendarContainer),clearInterval(this.timer)},setPosition:function(){var t=0,n=0;this.settings.target&&e(this.settings.target).size()&&(e(this.settings.target)[0].nodeType===1?(n=e(this.settings.target).offset().top+e(this.settings.target).outerHeight(),t=e(this.settings.target).offset().left):(n=e(this.settings.target).prev().offset().top+e(this.settings.target).prev().outerHeight(),t=e(this.settings.target).prev().offset().left),this.calendarContainer.css({top:n,left:t}))},setDate:function(e){var t=this,n;if(typeof e=="object")t.defaultDate=e,n=e.getFullYear()+t.separator+t._getTowNum(e.getMonth()+1)+t.separator+t._getTowNum(e.getDate()),t.settings.time&&(n+=" "+t._getTowNum(e.getHours())+":"+t._getTowNum(e.getMinutes())+":"+t._getTowNum(e.getSeconds()));else{var r=e.split(" "),i=r[0],s=r[1]||"00:00:00",o=i.split(t.separator);t.defaultDate=new Date(o[0],parseInt(o[1])-1,o[2],s.split(":")[0],s.split(":")[1],s.split(":")[2]),n=e}return t.date=t.defaultDate,n},bindEvent:function(){var t=this;e(".ui-calendar-control[data-role]",t.calendarContainer).click(function(){return t.go[e(this).data("role")].call(t),!1}),e(t.calendarContainer).click(function(){return!1}),e(".c_days",t.calendarContainer).delegate("li","click",function(){t.settings.beforeSelect&&t.settings.beforeSelect(t.date,t.calendarContainer);if(e(this).hasClass("disabled"))return!1;var n=e(this).data("value");t.setDate(n);if(t.settings.multiple)if(!e(this).hasClass("focus")){if(t.maxDays<=t.dateArr.length)return t.settings.overdays&&t.settings.overdays(t.maxDays,t.dateArr,t.calendarContainer),!1;t.dateArr.push(t.defaultDate)}else t._removeDate(t.defaultDate,t.dateArr);else t.dateArr=[t.date];return t.formatDate(),t.renderHeader(),t.settings.selected&&t.settings.selected(t.date,t.calendarContainer),t.settings.target&&e(t.settings.target).size()&&e(t.settings.target)[0].nodeType===1&&t.autohide&&(e(t.settings.target).val(n),t.hide(),t.settings.afterSelected&&t.settings.afterSelected(e(t.settings.target),t.date,t.calendarContainer)),!1}),e(".ui-calendar-toolbar",t.calendarContainer).delegate("a","click",function(){if(e(this).hasClass("js-calendar-submit")){t.settings.selected&&t.settings.selected(t.dateArr,t.calendarContainer),t.dateArr.length===0&&t.dateArr.push(e(".focus",t.calendarContainer).data("value"));var n=t._toString(t.dateArr);i=n.join(t.mutilSeparator),t.settings.time&&(i+=" "+e(".js-calendar-hours",t.calendarContainer).val()+":"+e(".js-calendar-minutes",t.calendarContainer).val()+":"+e(".js-calendar-second",t.calendarContainer).val()),e(t.settings.target).val(i),t.hide()}e(this).hasClass("ui-calendar-close")&&t.hide();if(e(this).hasClass("ui-calendar-today")){var r=new Date,i=t.setDate(r);t.date=r,t.hide(),e(t.settings.target).val(i)}e(this).hasClass("js-clear")&&(t.dateArr=[],e(t.settings.target).val(""),t.formatDate())}),t.settings.target&&(e(t.settings.target).bind("click",function(){return e(document).trigger("click"),t.show(),!1}),e(document).click(function(){t.isShow&&t.hide()}))},actionFlow:function(e,t){e.siblings(".ui-calendar-flow").length?e.siblings(".ui-calendar-flow").hide(300,function(){e[t](300)}):e[t](300)},go:{"next-month":function(){this.month+=1,this._getDate(),this.formatDate(),this.renderHeader()},"prev-month":function(){this.month-=1,this.changeDate()},"next-year":function(){this.year+=1,this.changeDate()},"prev-year":function(){this.year-=1,this.changeDate()},"current-year":function(t){var n=this;this.yearContainer?t||n.actionFlow(n.yearContainer,"toggle"):(this.yearContainer=e('<div class="ui-year-list ui-calendar-flow"/>'),this.calendarContainer.append(this.yearContainer),n.actionFlow(n.yearContainer,"show"),this.yearContainer.on("click","div",function(){var t=e(this).data("value");n.year=t,n.changeDate(),e(this).hasClass("cross")?n.go["current-year"].call(n,!0):n.actionFlow(n.yearContainer,"hide")}));var r=Math.floor(n.year/10);this.yearContainer.html(""),this.yearContainer.append('<div class="cross prevtenyear" data-value="'+((r-1).toString()+9)+'">...</div>');for(var i=0,s=10;i<s;i++){var o=r.toString()+i,u="";n.year==o&&(u=' class="current" '),this.yearContainer.append("<div "+u+' data-value="'+o+'">'+o+"</div>")}this.yearContainer.append('<div class="cross nexttenyear" data-value="'+((r+1).toString()+0)+'">...</div>')},"current-month":function(){var t=this;this.monthContainer?t.actionFlow(t.monthContainer,"toggle"):(this.monthContainer=e('<div class="ui-month-list ui-calendar-flow"/>'),this.calendarContainer.append(this.monthContainer),t.actionFlow(t.monthContainer,"show"),this.monthContainer.on("click","div",function(){var n=e(this).data("value");t.month=n,t.changeDate(),t.monthContainer.hide(300)})),this.monthContainer.html("");for(var n=0,r=this.monthArr.length;n<r;n++){var i=this.monthArr[n],s="";t.month==n&&(s=' class="current" '),this.monthContainer.append("<div "+s+' data-value="'+n+'">'+i+"</div>")}}},changeDate:function(){this._getDate(),this.formatDate(),this.renderHeader()},renderHeader:function(){e('[data-role="current-month"]',this.calendarContainer).html(this.monthArr[this.month]),e('[data-role="current-year"]',this.calendarContainer).html(this.year);var t="";for(var n=0,r=this.dayArr.length;n<r;n++)t+="<b>"+this.dayArr[n]+"</b>";e(".calendar-header",this.calendarContainer).html(t)},_getDate:function(){this.date=new Date(this.year,this.month,this.day)},formatDate:function(){var t=this.date;this.year=t.getFullYear(),this.month=t.getMonth(),this.day=t.getDate();var n=new Date(this.year,this.month+1,0),r=n.getDate(),i="<ul>",s=(new Date(this.year,this.month,1)).getDay(),o=new Date(this.year,this.month,0),u=o.getDate(),a=new Date(this.year,this.month+2,0);s>0&&(i+=this._getDay(u-s+1,u,"preday",o)),i+=this._getDay(1,r,"",this.date);var f=(new Date(this.year,this.month,r)).getDay();i+=this._getDay(1,6-f,"nextday",a),i+="</ul>",e("#"+this.id).find(".c_days").html(i)},_toString:function(e){var t=[],n=e.length;for(var r=0;r<n;r++){var i=e[r];typeof i=="string"&&(e[r]=new Date(i));for(var s=0;s<r;s++)if(i.getTime()<e[s]){var o=e[r];e[r]=e[s],e[s]=o}}for(var r=0,u=e.length;r<u;r++){var a=e[r],f=a.getFullYear(),l=this._getTowNum(a.getMonth()+1),c=this._getTowNum(a.getDate());t.push(f+this.separator+l+this.separator+c)}return t},_getDay:function(e,t,n,r){var i="",s=this.range[0],o=this.range[1];s&&(s=Date.parse(s)),o&&(o=Date.parse(o));for(var u=e;u<=t;u++){var a=n||"",f=r.getFullYear()+this.separator+this._getTowNum(r.getMonth()+1)+this.separator;f+=this._getTowNum(u);var l=new Date(r.getFullYear(),r.getMonth(),u),c=l.getTime();this.settings.multiple?this._dateInArr(l,this.dateArr)&&(a+=" focus"):c==+(new Date(this.defaultDate.getFullYear(),this.defaultDate.getMonth(),this.defaultDate.getDate()))&&(a+=" focus");if(s&&c<s||o&&c>o)a+=" disabled";this.settings.filter&&!this.settings.filter(c)&&(a+=" disabled"),i+='<li class="'+a+'" data-value="'+f+'">'+u+"</li>"}return i},_dateInArr:function(e,t){for(var n=t.length-1;n>=0;n--){var r=t[n],i=r;if(typeof r=="string"){var s=r.split(this.separator);i=new Date(s[0],parseInt(s[1])-1,s[2])}if(e.getTime()==i.getTime())return!0}},_removeDate:function(e,t){var n=[];for(var r=t.length-1;r>=0;r--){var i=t[r],s=i;if(typeof i=="string"){var o=i.split(this.separator);s=new Date(o[0],parseInt(o[1])-1,o[2])}if(e.getTime()==s.getTime())continue;n.push(s)}this.dateArr=n},_getTowNum:function(e){return("0"+e.toString()).substr(-2)}},t}),function(e,t){typeof define=="function"&&define.amd?define("page/corp-license/main",["$","dialog","area","upload","calendar"],t):e.Index=t($,Dialog,Area,Upload)}(this,function($,dialog,Area,Upload,Calendar){return{init:function(){function showok(e){var t=$(e).nextAll(".tips");t.hide()}function showerror(e,t){var n=$(e).nextAll(".tips");n.show().children("b").html(t);var r=e.position().top+50;n.css({left:e.position().left-10,top:r})}$(".calendar").Calendar({zIndex:34,afterSelected:function(e){$(e).blur()}}),$(".required").each(function(){$(this).blur(function(){var e=$(this),t=$(this).val();if($(this).val().length==0)showerror($(this),$(this).attr("required-msg"));else{var n=$(this).data("type");switch(n){case"email":var r=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;r.test(t)?showok(e,""):showerror(e,"邮箱格式错误");break;case"phone":var r=/^[1]\d{10}$/;r.test(t)?showok(e,""):showerror(e,"手机号码格式错误");break;case"number":isNaN(t)?showerror(e,"数字格式错误"):showok(e,"");break;default:showok($(this))}}})}),$(".js-basic-infor").submit(function(){var e=this;$("input",this).each(function(){$(this).trigger("blur")});var t=!0;$(".upload").each(function(){var e=$(this).nextAll(":hidden");if($.trim(e.val()).length===0){t=!1;var n=this;$(n).addClass("error"),$(n).find("h4").html("<s></s>请上传证照"),$(n).find("p").html("")}});if(!t)return!1;var n=$(".required");for(var r=0,i=n.length;r<i;r++)if($(n[r]).val().length==0)return!1;if($(".tips:visible").size())return!1;var s=$(this).attr("action"),o=$(this).serialize();return $.post(s,o,function(t){t.status&&(location.href=$(e).data("next"))}),!1}),Area.init(CONFIG.area),$(".upload").each(function(){var _this=this;(function(_this){var upload=new Upload;$(_this).append("<img>"),$(_this).find("img").hide(),upload.init({target:$(_this),url:"../json/upload.json",accept:"png,jpg",startUpload:function(e,t,n){$(_this).find("img").hide(),$(t).find("p").html("正在上传"),$(t).addClass("loading").find("h4").html("<b></b>")},callback:function(result,file,name,target,i){eval("result="+result),setTimeout(function(){$(target).removeClass("loading"),result.status?($(_this).find("img").show(),$(_this).children("img").attr("src",result.data),$(_this).nextAll("input").val(result.data)):($(target).addClass("error"),$(target).find("h4").html("<i></i>上传失败"),$(target).find("p").html(result.msg))},1e3)}})})(_this)})}}});