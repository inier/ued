/*
 * Created with Sublime Text 2.
 * license: http://www.lovewebgames.com/jsmodule/index.html
 * User: 田想兵
 * Date: 2015-03-16
 * Time: 20:27:54
 * Contact: 55342775@qq.com
 */

(function(e,t){typeof define=="function"&&define.amd?define("dialog",["$"],t):typeof exports=="object"?module.exports=t():e.Dialog=t(window.Zepto||window.jQuery||$)})(this,function(e){e.fn.Dialog=function(n){var r=[];return e(this).each(function(){var i=new t,s=e.extend({trigger:e(this)},n);i.init(s),r.push(i)}),r},e.Dialog=function(n){if(n.type==="alert"){var r=new t,i='<div class="ui-alert-title">'+n.content+"</div>",s="";n.button?(typeof n.button=="boolean"&&(n.button="确定"),s='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+n.button+"</button></p>"):n.timer||(n.timer=3e3),i+=s;var o=e.extend({target:i,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(e){this.dispose(),n.callback&&n.callback()}},n);r.init(o),n.timer&&setTimeout(function(){r.dispose(),n.callback&&n.callback()},n.timer),r.touch(r.mask,function(){r.dispose(),n.callback&&n.callback()})}if(n.type==="confirm"){var u=new t,i='<div class="ui-confirm-title">'+n.content+"</div>",s="";n.buttons||(n.buttons=[{yes:"确定"},{no:"取消"}]);var a="";for(var f=0,l=n.buttons.length;f<l;f++){var c=n.buttons[f];c.yes&&(a+='<td><button class="ui-confirm-submit " data-type="yes">'+c.yes+"</button></td>"),c.no&&(a+='<td><button class="ui-confirm-no" data-type="no">'+c.no+"</button></td>"),c.close&&(a+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+c.close+"</button></td>")}s='<table class="ui-dialog-action"><tr>'+a+"</tr></table>",i+=s;var h=e.extend({target:i,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(e){this.dispose()},beforeShow:function(t){u.touch(e(".ui-confirm-submit",t),function(){n.callback&&n.callback.call(u,"yes",t)}),u.touch(e(".ui-confirm-no",t),function(){n.callback&&n.callback.call(u,"no",t)}),u.touch(e(".ui-confirm-close",t),function(){n.callback&&n.callback.call(u,"close",t)})}},n);u.init(h)}},e.alert=function(t,n,r,i,s){var o={},u={zIndex:100,type:"alert"};typeof t=="object"?o=e.extend(u,t):o=e.extend(u,{content:t,button:n,timer:i,callback:r}),e.Dialog(e.extend(o,s))},e.confirm=function(t,n,r,i){var s={},o={zIndex:100,type:"confirm"};typeof t=="object"?s=e.extend(o,t):s=e.extend(o,{content:t,buttons:n,callback:r}),e.Dialog(e.extend(s,i))};var t=function(){var t=Math.random().toString().replace(".","");this.id="dialog_"+t,this.settings={},this.settings.closeTpl=e('<span class="ui-dialog-close js-dialog-close">x</span>'),this.settings.titleTpl=e('<div class="ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=e()};return t.prototype={init:function(t){var n=this;this.settings=e.extend({},this.settings,t),this.settings.mask&&(this.mask=e('<div class="ui-dialog-mask"/>'),e("body").append(this.mask)),e("body").append('<div class="ui-dialog" id="'+this.id+'"></div>'),this.dialogContainer=e("#"+this.id);var r=this.settings.zIndex||10;this.dialogContainer.css({zIndex:r}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:r-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},touch:function(t,n){function i(e){return n.call(this,e)}var r;e(t).on("click",i),e(t).on("touchmove",function(e){r=!0}).on("touchend",function(e){e.preventDefault();if(!r){var t=n.call(this,e,"touch");t||(e.preventDefault(),e.stopPropagation())}r=!1})},bindEvent:function(){var t=this;this.settings.trigger&&(e(this.settings.trigger).click(function(){t.show()}),t.touch(e(this.settings.trigger),function(){t.show()})),e(this.dialogContainer).delegate(".js-dialog-close","click",function(){return t.hide(),!1}),e(window).keydown(function(e){e.keyCode===27&&t.showed&&t.hide()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var t=this;t.settings.beforeHide&&t.settings.beforeHide.call(t,t.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){t.dialogContainer.hide(),typeof t.settings.target=="object"&&e("body").append(t.dialogContainer.hide()),t.settings.afterHide&&t.settings.afterHide.call(t,t.dialogContainer)},500)):(this.dialogContainer.hide(),typeof this.settings.target=="object"&&e("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer))},show:function(){typeof this.settings.target=="string"?/^(\.|\#\w+)/gi.test(this.settings.target)?this.dailogContent=e(this.settings.target):this.dailogContent=e("<div>"+this.settings.target+"</div>"):this.dailogContent=this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,e(this.settings.trigger).blur(),this.setPosition();var t=this;this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){t.setPosition()},1e3),this.settings.animate&&this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")},setPosition:function(){if(this.showed){var e=this;this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var t=this.settings.clientHeight||document.documentElement.clientHeight||document.body.clientHeight,n=this.settings.clientWidth||document.documentElement.clientWidth||document.body.clientWidth,r=this.width/2,i=this.height/2,s=n/2-r,o=t/2-i;s=Math.max(0,s),o=Math.max(0,o),e.dialogContainer.css({position:"fixed",top:o,left:s})}}},t}),function(e,t){typeof define=="function"&&define.amd?define("area",["$"],t):typeof exports=="object"?module.exports=t():e.Area=t(window.Zepto||window.jQuery||$)}(this,function(e){return{init:function(t){e.get(t,function(t){e(".area-input").each(function(){var n=e(".province .area-content",this),r=e(".city .area-content ul",this),i=e(".downtown .area-content ul",this),s=[t.data],o=e("<div/>");for(var u=0,a=s.length;u<a;u++){var f=e("<ul/>"),l=s[u];for(var c=0,h=l.length;c<h;c++){var p=e('<li data-value="'+s[u][c].id+'">'+s[u][c].name+"</li>");f.append(p);var d=s[u][c].child||[];p.click(function(t,n){r.children().hide();var s=r.closest(".area");e(s.children("input")).val(""),e(s.children("span")).html("-- 城市 --"),i.children().hide();var o=i.closest(".area");return e(o.children("input")).val(""),e(o.children("span")).html("-- 市区 --"),(e(this).data("child")||e([])).each(function(){e(this).show()}),n});var v=e("#hd_province");v.val()==s[u][c].id&&(v.next().html(s[u][c].name),function(e){setTimeout(function(){e.trigger("click",!1)})}(p));for(var m=0,g=d.length;m<g;m++){if(!d[m])continue;var y=e('<li data-value="'+d[m].id+'" >'+d[m].name+"</li>"),b=p.data("child",p.data("child")||[]);b.push(y),p.data("child",b),p.data("child"),y.hide(),r.append(y),y.click(function(t,n){return i.children().hide(),(e(this).data("child")||e([])).each(function(){e(this).show()}),n});var v=e("#hd_city");if(v.val()==d[m].id){var w=d[m].name;(function(e,t){setTimeout(function(){e.next().html(w),t.trigger("click",!1)},20)})(v,y)}var E=d[m].child||[];for(var S=0,x=E.length;S<x;S++){if(!E[S])continue;var T=e('<li data-value="'+E[S].id+'">'+E[S].name+"</li>"),b=y.data("child",y.data("child")||[]);b.push(T),y.data("child",b),y.data("child"),T.hide(),i.append(T);var N=e("#hd_downtown");if(N.val()==E[S].id){var C=E[S].name;(function(e){setTimeout(function(){e.next().html(C)},40)})(N)}}}}o.append(f)}n.html(o)})},"json").fail(function(){e.alert("加载地区信息出错，请稍后重试！")}),e(".area-input .area").click(function(){e(".area-input .area").removeClass("active"),e(".area-content").not(e(this).find(".area-content")).hide(),e(this).find(".area-content").toggle();var t=e(this).closest(".area-row");return e(this).find(".area-content:visible").size()?(e(this).addClass("active"),t.css("zIndex",44)):(e(this).removeClass("active"),t.css("zIndex",22)),!1}),e(".area-input .area-content").on("click","ul",function(){return!1}),e(".area-input .area-content").on("click","li",function(){var t=e(this).closest(".area");return t.find("input").val(e(this).data("value")),t.children("span").html(e(this).html()),t.trigger("click"),!1}),e("body").click(function(){e(".area-content").hide(),e(".area-input .area").removeClass("active"),e(".area-row").css("zIndex",22)})}}}),function(e,t){typeof define=="function"&&define.amd?define("page/info/main",["$","dialog","area"],t):e.Index=t($,Dialog,Area)}(this,function(e,t,n){return{init:function(){function t(t){var n=e(t).nextAll(".tips");n.hide()}function r(t,n){var r=e(t).nextAll(".tips");r.show().children("b").html(n);var i=t.position().top+50;r.css({left:t.position().left-10,top:i})}n.init(CONFIG.area),e(".tab-title a").click(function(){var t=e(this).index();e(".tab-list").children().eq(t).addClass("current").siblings().removeClass("current"),e(this).addClass("current").siblings().removeClass("current")}),e(".required").each(function(){e(this).blur(function(){var n=e(this),i=e(this).val();if(e(this).val().length==0)r(e(this),e(this).attr("required-msg"));else{var s=e(this).data("type");switch(s){case"email":var o=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;o.test(i)?t(n,""):r(n,"邮箱格式错误");break;case"phone":var o=/^[1]\d{10}$/;o.test(i)?t(n,""):r(n,"手机号码格式错误");break;case"number":isNaN(i)?r(n,"数字格式错误"):t(n,"");break;default:t(e(this))}}})}),e(".js-info-edit").submit(function(){var t=this;e("input",this).each(function(){e(this).trigger("blur")});var n=e(".required");for(var r=0,i=n.length;r<i;r++)if(e(n[r]).val().length==0)return!1;if(e(".tips:visible").size())return!1;var s=e(this).attr("action"),o=e(this).serialize();return e.post(s,o,function(n){n.status&&(location.href=e(t).data("next"))}),!1})}}});